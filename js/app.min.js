(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0),window.addEventListener("load",(function(){document.querySelector("body")&&setTimeout((function(){document.querySelector("body").classList.add("_loaded")}),200)})),sessionStorage.getItem("preloader")&&(document.querySelector(".preloader")&&document.querySelector(".preloader").classList.add("_hide"),document.querySelector(".wrapper").classList.add("_visible")),sessionStorage.getItem("money")||sessionStorage.setItem("money",1e3),document.querySelector(".check").textContent=sessionStorage.getItem("money"),document.querySelector(".game")&&(d("bomb"),d("anvil"),d("circle")),document.querySelector(".mini-game")&&(document.querySelector(".footer__coins").textContent=50,sessionStorage.setItem("current-bet",50));const t=document.querySelector(".preloader"),s=document.querySelector(".wrapper");function o(e,t){document.querySelector(e).classList.contains(t)?document.querySelector(e).classList.remove(t):document.querySelector(e).classList.add(t)}function c(e,t){let s=+sessionStorage.getItem("money");sessionStorage.setItem("money",s-e),setTimeout((()=>{document.querySelector(t).classList.add("_delete-money"),document.querySelector(t).textContent=sessionStorage.getItem("money")}),500),setTimeout((()=>{document.querySelector(t).classList.remove("_delete-money")}),1500)}function r(e){document.querySelector(e).classList.add("_no-money"),setTimeout((()=>{document.querySelector(e).classList.remove("_no-money")}),1e3)}function n(){return+sessionStorage.getItem("current-bet")}function l(e,t,s,o){setTimeout((()=>{document.querySelector(t).textContent=+sessionStorage.getItem("money")+e,document.querySelector(t).classList.add("_anim-add-money"),sessionStorage.setItem("money",+sessionStorage.getItem("money")+e)}),s),setTimeout((()=>{document.querySelector(t).classList.remove("_anim-add-money")}),o)}document.addEventListener("click",(e=>{let _=e.target;if(_.closest(".acces-preloader__button")&&(sessionStorage.setItem("preloader",!0),t.classList.add("_hide"),s.classList.add("_visible")),_.closest(".footer__minus")){let e=+sessionStorage.getItem("current-bet");e>50&&(sessionStorage.setItem("current-bet",e-50),document.querySelector(".footer__coins").textContent=sessionStorage.getItem("current-bet"))}if(_.closest(".footer__plus")){let e=+sessionStorage.getItem("current-bet");+sessionStorage.getItem("money")>e&&(sessionStorage.setItem("current-bet",e+50),document.querySelector(".footer__coins").textContent=sessionStorage.getItem("current-bet"))}_.closest(".footer__button_bet")&&(+sessionStorage.getItem("money")>=+sessionStorage.getItem("current-bet")?(o(".footer__button_bet","_hold"),o(".footer__controls","_hold"),c(n(),".check"),u(),setTimeout((()=>{var e,t;(function(e){let t=n();e>=0&&e<=19?(m(3,3,3),l(.01*t,".check",2500,3500),i(.01*t,.01),a(1)):e>=20&&e<=23?(m(3,3,4),l(2*t,".check",2500,3500),i(2*t,2),a(2)):e>=24&&e<=26?(m(3,3,1),l(5*t,".check",2500,3500),i(5*t,5),a(3)):e>=27&&e<=29?(m(3,3,5),l(10*t,".check",2500,3500),i(10*t,10),a(4)):e>=30&&e<=31?(m(3,3,2),l(15*t,".check",2500,3500),i(15*t,15),a(5)):e>=32&&e<=33?(m(3,2,1),l(32*t,".check",2500,3500),i(32*t,32),a(6)):34==e?(m(4,2,1),l(42*t,".check",2500,3500),i(42*t,42),a(7)):35==e?(m(1,5,4),l(53*t,".check",2500,3500),i(53*t,53),a(8)):36==e&&(m(2,5,4),l(60*t,".check",2500,3500),i(60*t,60),a(9))})((e=0,t=36,Math.floor(Math.random()*(t-e)+e))),setTimeout((()=>{document.querySelector(".win").classList.add("_active")}),2e3)}),1e3)):r(".check")),_.closest(".win__button_play")&&(document.querySelector(".win").classList.remove("_active"),u(),o(".footer__button_bet","_hold"),o(".footer__controls","_hold"),document.querySelectorAll(".block-mini-game__box").forEach((e=>{e.dataset.level&&e.classList.remove("_selected")}))),document.querySelector(".shop")&&document.querySelector(".shop").classList.contains("_active")&&!_.closest(".shop__body")&&document.querySelector(".shop").classList.remove("_active"),(_.closest(".bonuses__count_bomb")||_.closest(".bonuses__count_anvil")||_.closest(".bonuses__count_circle"))&&document.querySelector(".shop").classList.add("_active"),_.closest(".bonuses__button_bomb")&&(+sessionStorage.getItem("money")>=3500?(c(3500,".check"),sessionStorage.setItem("bonus-bomb",+sessionStorage.getItem("bonus-bomb")+1),d("bomb")):r(".check")),_.closest(".bonuses__button_anvil")&&(+sessionStorage.getItem("money")>=5500?(c(5500,".check"),sessionStorage.setItem("bonus-anvil",+sessionStorage.getItem("bonus-anvil")+1),d("anvil")):r(".check")),_.closest(".bonuses__button_circle")&&(+sessionStorage.getItem("money")>=7500?(c(7500,".check"),sessionStorage.setItem("bonus-circle",+sessionStorage.getItem("bonus-circle")+1),d("circle")):r(".check")),_.closest(".bonuses__bomb")&&!_.closest(".bonuses__count_bomb")&&0!=+sessionStorage.getItem("bonus-bomb")&&(sessionStorage.setItem("bonus-bomb",+sessionStorage.getItem("bonus-bomb")-1),d("bomb")),_.closest(".bonuses__anvil")&&!_.closest(".bonuses__count_anvil")&&0!=+sessionStorage.getItem("bonus-anvil")&&(sessionStorage.setItem("bonus-anvil",+sessionStorage.getItem("bonus-anvil")-1),d("anvil")),_.closest(".bonuses__circle")&&!_.closest(".bonuses__count_circle")&&0!=+sessionStorage.getItem("bonus-circle")&&(sessionStorage.setItem("bonus-circle",+sessionStorage.getItem("bonus-circle")-1),d("circle"))}));function m(e,t,s){let o=document.createElement("img"),c=document.createElement("img"),r=document.createElement("img");o.setAttribute("src",`img/mini-game/crystall-${e}.png`),c.setAttribute("src",`img/mini-game/crystall-${t}.png`),r.setAttribute("src",`img/mini-game/crystall-${s}.png`),document.querySelector(".crystalls__item_1").append(o),document.querySelector(".crystalls__item_1").classList.add(`_bg-${e}`),setTimeout((()=>{document.querySelector(".crystalls__item_2").append(c),document.querySelector(".crystalls__item_2").classList.add(`_bg-${t}`)}),500),setTimeout((()=>{document.querySelector(".crystalls__item_3").append(r),document.querySelector(".crystalls__item_3").classList.add(`_bg-${s}`)}),1e3)}function i(e,t){document.querySelector(".win__text").textContent=e,document.querySelector(".win__rate").textContent=`x${t}`}function a(e){setTimeout((()=>{document.querySelectorAll(".block-mini-game__box").forEach((t=>{t.dataset.level==e&&t.classList.add("_selected")}))}),1200)}function u(){document.querySelector(".crystalls__item_1 img")&&(document.querySelector(".crystalls__item_1 img").remove(),document.querySelector(".crystalls__item_2 img").remove(),document.querySelector(".crystalls__item_3 img").remove(),document.querySelector(".crystalls__item_1").classList.contains("_bg-1")?document.querySelector(".crystalls__item_1").classList.remove("_bg-1"):document.querySelector(".crystalls__item_1").classList.contains("_bg-2")&&document.querySelector(".crystalls__item_1").classList.remove("_bg-2"),document.querySelector(".crystalls__item_1").classList.contains("_bg-3")&&document.querySelector(".crystalls__item_1").classList.remove("_bg-3"),document.querySelector(".crystalls__item_1").classList.contains("_bg-4")&&document.querySelector(".crystalls__item_1").classList.remove("_bg-4"),document.querySelector(".crystalls__item_1").classList.contains("_bg-5")&&document.querySelector(".crystalls__item_1").classList.remove("_bg-5"),document.querySelector(".crystalls__item_2").classList.contains("_bg-1")?document.querySelector(".crystalls__item_2").classList.remove("_bg-1"):document.querySelector(".crystalls__item_2").classList.contains("_bg-2")&&document.querySelector(".crystalls__item_2").classList.remove("_bg-2"),document.querySelector(".crystalls__item_2").classList.contains("_bg-3")&&document.querySelector(".crystalls__item_2").classList.remove("_bg-3"),document.querySelector(".crystalls__item_2").classList.contains("_bg-4")&&document.querySelector(".crystalls__item_2").classList.remove("_bg-4"),document.querySelector(".crystalls__item_2").classList.contains("_bg-5")&&document.querySelector(".crystalls__item_2").classList.remove("_bg-5"),document.querySelector(".crystalls__item_3").classList.contains("_bg-1")?document.querySelector(".crystalls__item_3").classList.remove("_bg-1"):document.querySelector(".crystalls__item_3").classList.contains("_bg-2")&&document.querySelector(".crystalls__item_3").classList.remove("_bg-2"),document.querySelector(".crystalls__item_3").classList.contains("_bg-3")&&document.querySelector(".crystalls__item_3").classList.remove("_bg-3"),document.querySelector(".crystalls__item_3").classList.contains("_bg-4")&&document.querySelector(".crystalls__item_3").classList.remove("_bg-4"),document.querySelector(".crystalls__item_3").classList.contains("_bg-5")&&document.querySelector(".crystalls__item_3").classList.remove("_bg-5"))}function d(e){0==+sessionStorage.getItem(`bonus-${e}`)?document.querySelector(`.bonuses__count_${e}`).textContent="+":document.querySelector(`.bonuses__count_${e}`).textContent=sessionStorage.getItem(`bonus-${e}`)}let _={countRows:6,countCols:5,offsetBorder:10,borderRadius:8,gemSize:63,imagesCoin:["img/game/game-img-1.png","img/game/game-img-2.png","img/game/game-img-3.png","img/game/game-img-4.png"],gemClass:"gem",gemIdPrefix:"gem",gameStates:["pick","switch","revert","remove","refill"],gameState:"",movingItems:0,countScore:0},g={selectedRow:-1,selectedCol:-1,posX:"",posY:""},S={container:document.createElement("div"),content:document.createElement("div"),wrapper:document.createElement("div"),cursor:document.createElement("div"),score:document.createElement("div"),gems:new Array},y=null,b=null,f=0;function p(e,t){1==Math.abs(g.selectedRow-t)&&g.selectedCol==e||1==Math.abs(g.selectedCol-e)&&g.selectedRow==t?(_.gameState=_.gameStates[1],g.posX=e,g.posY=t,L()):(g.selectedRow=t,g.selectedCol=e)}function q(e,t,s,o,c){let r=document.createElement("div");r.classList.add(_.gemClass),r.id=`${_.gemIdPrefix}_${s}_${o}`,r.style.top=`${e}px`,r.style.left=`${t}px`,r.style.backgroundImage=`url('${c}')`,S.wrapper.append(r)}function v(e,t){return h(e,t)||I(e,t)}function h(e,t){let s=S.gems[e][t],o=0,c=e;for(;c>0&&S.gems[c-1][t]==s;)o++,c--;for(c=e;c<_.countRows-1&&S.gems[c+1][t]==s;)o++,c++;return o>1}function I(e,t){let s=S.gems[e][t],o=0,c=t;for(;c>0&&S.gems[e][c-1]==s;)o++,c--;for(c=t;c<_.countCols-1&&S.gems[e][c+1]==s;)o++,c++;return o>1}function L(){let e=g.selectedRow-g.posY,t=g.selectedCol-g.posX;document.querySelector("#"+_.gemIdPrefix+"_"+g.selectedRow+"_"+g.selectedCol).classList.add("switch"),document.querySelector("#"+_.gemIdPrefix+"_"+g.selectedRow+"_"+g.selectedCol).setAttribute("dir","-1"),document.querySelector("#"+_.gemIdPrefix+"_"+g.posY+"_"+g.posX).classList.add("switch"),document.querySelector("#"+_.gemIdPrefix+"_"+g.posY+"_"+g.posX).setAttribute("dir","1"),$(".switch").each((function(){_.movingItems++,$(this).animate({left:"+="+t*_.gemSize*$(this).attr("dir"),top:"+="+e*_.gemSize*$(this).attr("dir")},{duration:250,complete:function(){w()}}),$(this).removeClass("switch")})),document.querySelector("#"+_.gemIdPrefix+"_"+g.selectedRow+"_"+g.selectedCol).setAttribute("id","temp"),document.querySelector("#"+_.gemIdPrefix+"_"+g.posY+"_"+g.posX).setAttribute("id",_.gemIdPrefix+"_"+g.selectedRow+"_"+g.selectedCol),document.querySelector("#temp").setAttribute("id",_.gemIdPrefix+"_"+g.posY+"_"+g.posX);let s=S.gems[g.selectedRow][g.selectedCol];S.gems[g.selectedRow][g.selectedCol]=S.gems[g.posY][g.posX],S.gems[g.posY][g.posX]=s}function w(){if(_.movingItems--,0==_.movingItems)switch(_.gameState){case _.gameStates[1]:case _.gameStates[2]:v(g.selectedRow,g.selectedCol)||v(g.posY,g.posX)?(_.gameState=_.gameStates[3],v(g.selectedRow,g.selectedCol)&&C(g.selectedRow,g.selectedCol),v(g.posY,g.posX)&&C(g.posY,g.posX),x()):_.gameState!=_.gameStates[2]?(_.gameState=_.gameStates[2],L()):(_.gameState=_.gameStates[0],g.selectedRow=-1,g.selectedCol=-1);break;case _.gameStates[3]:A();break;case _.gameStates[4]:!function(){let e=0;for(let t=0;t<_.countCols;t++)-1==S.gems[0][t]&&(S.gems[0][t]=Math.floor(3*Math.random()+0),q(0,t*_.gemSize,0,t,_.imagesCoin[S.gems[0][t]]),e++);if(e)_.gameState=_.gameStates[3],A();else{let e=0;for(let t=0;t<_.countRows;t++)for(let s=0;s<_.countCols;s++)s<=_.countCols-3&&S.gems[t][s]==S.gems[t][s+1]&&S.gems[t][s]==S.gems[t][s+2]&&(e++,C(t,s)),t<=_.countRows-3&&S.gems[t][s]==S.gems[t+1][s]&&S.gems[t][s]==S.gems[t+2][s]&&(e++,C(t,s));e>0?(_.gameState=_.gameStates[3],x()):(_.gameState=_.gameStates[0],g.selectedRow=-1)}}()}}function C(e,t){let s=S.gems[e][t],o=e;document.querySelector("#"+_.gemIdPrefix+"_"+e+"_"+t).classList.add("remove");let c=document.querySelectorAll(".remove").length;if(h(e,t)){for(;o>0&&S.gems[o-1][t]==s;)document.querySelector("#"+_.gemIdPrefix+"_"+(o-1)+"_"+t).classList.add("remove"),S.gems[o-1][t]=-1,o--,c++;for(o=e;o<_.countRows-1&&S.gems[o+1][t]==s;)document.querySelector("#"+_.gemIdPrefix+"_"+(o+1)+"_"+t).classList.add("remove"),S.gems[o+1][t]=-1,o++,c++}if(I(e,t)){for(o=t;o>0&&S.gems[e][o-1]==s;)document.querySelector("#"+_.gemIdPrefix+"_"+e+"_"+(o-1)).classList.add("remove"),S.gems[e][o-1]=-1,o--,c++;for(o=t;o<_.countCols-1&&S.gems[e][o+1]==s;)document.querySelector("#"+_.gemIdPrefix+"_"+e+"_"+(o+1)).classList.add("remove"),S.gems[e][o+1]=-1,o++,c++}var r;S.gems[e][t]=-1,(r=c)>=4?r*=2:r>=5?r=2*(r+1):r>=6&&(r*=2*(r+2)),_.countScore+=r,l(r,".check",500,1500),console.log(_.countScore)}function x(){$(".remove").each((function(){_.movingItems++,$(this).animate({opacity:0},{duration:200,complete:function(){$(this).remove(),w()}})}))}function A(){let e=0;for(let t=0;t<_.countCols;t++)for(let s=_.countRows-1;s>0;s--)-1==S.gems[s][t]&&S.gems[s-1][t]>=0&&(document.querySelector("#"+_.gemIdPrefix+"_"+(s-1)+"_"+t).classList.add("fall"),document.querySelector("#"+_.gemIdPrefix+"_"+(s-1)+"_"+t).setAttribute("id",_.gemIdPrefix+"_"+s+"_"+t),S.gems[s][t]=S.gems[s-1][t],S.gems[s-1][t]=-1,e++);$(".fall").each((function(){_.movingItems++,$(this).animate({top:"+="+_.gemSize},{duration:100,complete:function(){$(this).removeClass("fall"),w()}})})),0==e&&(_.gameState=_.gameStates[4],_.movingItems=1,w())}document.addEventListener("touchstart",(function(e){let t=e.target;if(f=0,t.closest(".gem")){let s=parseInt(t.getAttribute("id").split("_")[1]),o=parseInt(t.getAttribute("id").split("_")[2]);g.selectedRow=s,g.selectedCol=o,y=e.touches[0].clientX,b=e.touches[0].clientY}}),!1),document.addEventListener("touchend",(function(){setTimeout((()=>{g.selectedRow=-1,g.selectedCol=-1,console.log(g.selectedRow,g.selectedCol)}),500)}),!1),document.addEventListener("touchmove",(function(e){if(f>=1)return!1;f++;let t=e.target,s=e.touches[0].clientX,o=e.touches[0].clientY,c=s-y,r=o-b;t.closest(".gem");let n=g.selectedRow,l=g.selectedCol;Math.abs(c)>Math.abs(r)?p(c>0?l+1:l-1,n):p(l,r>0?n+1:n-1)}),!1),document.querySelector(".game")&&(S.content.style.width=_.gemSize*_.countCols+2*_.offsetBorder+"px",S.content.style.height=_.gemSize*_.countRows+2*_.offsetBorder+"px",document.querySelector(".block-game__field").append(S.content),S.wrapper.classList.add("block-game__wrapper"),S.content.append(S.wrapper),S.cursor.id="marker",S.cursor.style.width=_.gemSize+"px",S.cursor.style.height=_.gemSize+"px",S.cursor.style.border="2px solid white",S.cursor.style.borderRadius="5px",S.cursor.style.position="absolute",S.cursor.style.zIndex="1",S.cursor.style.display="none",S.wrapper.append(S.cursor),function(){for(let e=0;e<_.countRows;e++){S.gems[e]=new Array;for(let t=0;t<_.countCols;t++)S.gems[e][t]=-1}for(let e=0;e<_.countRows;e++)for(let t=0;t<_.countCols;t++){do{S.gems[e][t]=Math.floor(3*Math.random()+0)}while(v(e,t));q(e*_.gemSize,t*_.gemSize,e,t,_.imagesCoin[S.gems[e][t]])}}(),_.gameState=_.gameStates[0]),window.FLS=!0,function(e){let t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}))})();